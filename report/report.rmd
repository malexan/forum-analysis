Обсуждение проноса олимпийского факела по улицам Пскова
========================================================


```{r loading, echo=F, include=F}
Sys.setlocale('LC_TIME', 'ru_RU.UTF-8')
options(device = function(file, width = 7, height = 7, ...) {
  cairo_pdf(tempfile(), width = width, height = height, ...)
})
pdf.options(encoding='Cyrillic.enc')
source('../R/read.google.spreadsheet.r')
source('../R/setkey.r')
library(lubridate)
library(ggplot2)
library(stringr)
library(pander)

rmd.table <- function(t) {
  require(pander)
  pandoc.table(t, style = 'rmarkdown', split.tables = Inf,
             split.cells = Inf)
  }

data <- read.google.spreadsheet()

data$author <- factor(str_trim(as.character(data$author)))
data$date <- str_trim(as.character(data$date))
data$time <- str_trim(as.character(data$time))
data <- data[data$time != '' & data$author != '',]
data$timestamp <- dmy_hms(str_c(data$date, data$time, sep=' '))
data$nchcomm <- str_length(data$text)
```

```{r createtable, results='asis', echo=FALSE}

t <- as.data.frame(table(str_trim(as.character(data$author))))
rmd.table(t)
```

```{r timeofcommentbar, echo=FALSE}

f <- ggplot(data, aes(timestamp)) + geom_bar()
f <- f + ylab('Количество комментариев') + xlab('') +
  ggtitle('Всплески комментариев приходятся на
23 часа 21 октября и 11 часов 22 октября')
print(f)
```

```{r timeofcommentdensity, echo=FALSE}

f <- ggplot(data, aes(timestamp)) + geom_density()
f <- f + ylab('Относительная плотность комментариев') + xlab('') +
  ggtitle('Всплески комментариев приходятся на
23 часа 21 октября и 11 часов 22 октября') +
  scale_y_continuous(breaks=NULL)
print(f)
```

```{r nchardensity, echo=FALSE}

f <- ggplot(data, aes(nchcomm)) + geom_density()
f <- f + ylab('Плотность длины комментариев') + xlab('') +
  ggtitle('Чаще всего длина комментария\nне превышает 100 символов') +
  scale_y_continuous(breaks=NULL)
print(f)
```


```{r ncharbar, echo=FALSE}

f <- ggplot(data, aes(nchcomm)) + geom_bar()
f <- f + ylab('Количество комментариев с данной длиной') + xlab('') +
  ggtitle('Чаще всего длина комментария\nне превышает 100 символов') 
print(f)
```